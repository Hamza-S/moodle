YUI.add("moodle-atto_undo-button",function(e,t){M.atto_undo=M.atto_undo||{maxundos:40,undostack:{},redostack:{},undo_handler:function(e,t){e.preventDefault();var n=M.editor_atto.get_editable_node(t);M.atto_undo.redostack[t].push(n.getHTML());var r=M.atto_undo.undostack[t].pop();r===n.getHTML()&&(r=M.atto_undo.undostack[t].pop()),r&&(n.setHTML(r),M.atto_undo.undostack[t].push(r),M.editor_atto.add_widget_highlight(t,"undo","redo"))},redo_handler:function(e,t){e.preventDefault();var n=M.editor_atto.get_editable_node(t);M.atto_undo.undostack[t].push(n.getHTML());var r=M.atto_undo.redostack[t].pop();n.setHTML(r),M.atto_undo.undostack[t].push(r)},change_listener:function(e){var t=e.elementid,n=M.editor_atto.get_editable_node(t);if(e.event.type.indexOf("key")!==-1&&e.event.keyCode!==39&&e.event.keyCode!==37&&e.event.keyCode!==40&&e.event.keyCode!==38)return;typeof M.atto_undo.undostack[t]=="undefined"&&(M.atto_undo.undostack[t]=[]);var r=M.atto_undo.undostack[t][M.atto_undo.undostack[t].length-1];r!==n.getHTML()&&(M.atto_undo.undostack[t].push(n.getHTML()),M.atto_undo.redostack[t]=[],M.editor_atto.remove_widget_highlight(t,"undo","redo"));while(M.atto_undo.undostack[t].length>M.atto_undo.maxundos)M.atto_undo.undostack[t].shift();M.atto_undo.undostack[t].length?M.editor_atto.add_widget_highlight(t,"undo","undo"):M.editor_atto.remove_widget_highlight(t,"undo","undo")},init:function(e){var t=M.util.image_url("e/undo","core");M.editor_atto.add_toolbar_button(e.elementid,"undo",t,e.group,M.atto_undo.undo_handler,"undo",M.util.get_string("undo","atto_undo")),M.editor_atto.add_button_shortcut({action:"undo",keys:90}),t=M.util.image_url("e/redo","core"),M.editor_atto.add_toolbar_button(e.elementid,"undo",t,e.group,M.atto_undo.redo_handler,"redo",M.util.get_string("redo","atto_undo")),M.editor_atto.add_button_shortcut({action:"redo",keys:89}),M.editor_atto.on("atto:selectionchanged",M.atto_undo.change_listener)}}},"@VERSION@",{requires:["node","moodle-editor_atto-editor-shortcut"]});
