define(["core/mustache","jquery","core/ajax","core/str","core/notification","core/url","core/config"],function(a,b,c,d,e,f,g){var h={},i=[],j=[],k=1,l=function(b){var c,d=b.split(","),e="",g="",i="";d.length>0&&(e=d.shift().trim()),d.length>0&&(g=d.shift().trim()),d.length>0&&(i=d.join(",").trim());var j=f.imageUrl(e,g),k={src:j,alt:i,"class":"smallicon"},l=h["core/pix_icon"];return c=a.render(l,k,m),c.trim()},m=function(a){var b="";return s(a,!1).done(function(a){b=a}).fail(e.exception),b},n=function(a,b){return j.push(b(a,this)),""},o=function(a,b){var c=a.split(","),d="",e="",f="";c.length>0&&(d=c.shift().trim()),c.length>0&&(e=c.shift().trim()),c.length>0&&(f=c.join(",").trim()),""!==f&&(f=b(f,this)),0===f.indexOf("{")&&0!==f.indexOf("{{")&&(f=JSON.parse(f));var g=i.length;return i.push({key:d,component:e,param:f}),"{{_s"+g+"}}"},p=function(a){i=[],j=[],a.uniqid=k++,a.str=function(){return o},a.pix=function(){return l},a.js=function(){return n},a.globals={config:g}},q=function(a){var b="";j.length>0&&(b=j.join(";\n"));var c=0;for(c=0;c<a.length;c++)b=b.replace("{{_s"+c+"}}",a[c]);return b},r=function(c,e){var f=b.Deferred(),g=s("core/pix_icon",!0);return g.done(function(){p(e);var b="";try{b=a.render(c,e,m)}catch(g){f.reject(g)}i.length>0?d.get_strings(i).done(function(a){var c;for(c=0;c<a.length;c++)b=b.replace("{{_s"+c+"}}",a[c]);f.resolve(b.trim(),q(a))}).fail(function(a){f.reject(a)}):f.resolve(b.trim(),q([]))}).fail(function(a){f.reject(a)}),f.promise()},s=function(a,d){var e=b.Deferred(),f=a.split("/"),g=f.shift(),i=f.shift();if(a in h)e.resolve(h[a]);else{var j=c.call([{methodname:"core_output_load_template",args:{component:g,template:i}}],d);j[0].done(function(b){h[a]=b,e.resolve(b)}).fail(function(a){e.reject(a)})}return e.promise()};return{render:function(a,c){var d=b.Deferred(),e=s(a,!0);return e.done(function(a){var b=r(a,c);b.done(function(a,b){d.resolve(a,b)}).fail(function(a){d.reject(a)})}).fail(function(a){d.reject(a)}),d.promise()},runTemplateJS:function(a){var c=b("<script>").attr("type","text/javascript").html(a);b("head").append(c)}}});