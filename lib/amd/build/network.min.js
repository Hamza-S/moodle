define(["jquery","core/ajax","core/config","core/notification","core/str"],function(a,b,c,d,e){var f=!1,g=0,h=c.sessiontimeout/10*1e3,i=Math.max(2*h,9e5),j=function(){var a={methodname:"core_session_touch",args:{}};return b.call([a],!0,!0)[0].then(function(){return setTimeout(j,g),!0}).fail(d.exception)},k=function(){var a={methodname:"core_session_time_remaining",args:{}};return b.call([a],!0,!0)[0].then(function(a){return 1e3*a<i?(e.get_strings([{key:"inactive",component:"moodle"},{key:"sessiontimeoutsoon",component:"error"}]).then(function(a){return d.confirm(a[0],a[1],"Extend session","Cancel",function(){return console.log("Extend it."),!0}),!0}).fail(d.exception),setTimeout(k,i)):setTimeout(k,h),!0}).fail(d.exception)},l=function(){g>0?setTimeout(j,g):setTimeout(k,h)},m=function(){f||(f=!0,l())},n=function(a){f||(f=!0,g=1e3*a,l())};return{keepalive:n,init:m}});