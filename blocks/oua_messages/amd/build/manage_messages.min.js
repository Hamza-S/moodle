define(["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str","block_oua_messages/jquery.blockUI"],function(a,b,c,d,e,f,g,h){var i,j=function(c){var e=b.call([{methodname:"block_oua_messages_delete_message",args:{messageid:c}}]);a.when.apply(a,e).done(function(b){b.message_list&&(a("#message_accordion").replaceWith(b.message_list),a("#message_count").change()),a.isFunction(i.unblock)&&i.unblock()}).fail(d.exception)},k=function(){var b=a(".block_oua_messages .accordion").attr("data-count");"0"===b&&(b=""),a(".user-navigation .block_oua_messages .badge").text(b)};a("#message_accordion").parent().on("click",".message-delete",function(){var b=a(this),c=b.parents(".panel-body"),d=a("#confirm_delete_dialog");d.appendTo(c),c.css("position","relative"),d.modal({backdrop:!0}),a(".confirm-delete",d).data("messageid",b.data("messageid")),a(".modal-backdrop.in").appendTo(c).css("bottom",0),a("body").removeClass("modal-open").css("padding-right",0)}).on("click",".confirm-delete",function(b){var c=a(this).data("messageid");i=a("#notification_accordion").parent(),i.block({message:"<span class='glyphicon glyphicon-refresh glyphicon-refresh-animate spinning'></span>"}),j(c)}).on("change","#message_count",function(){k()});var l=function(a){b.call([{methodname:"block_oua_messages_mark_message_read",args:{messageid:a},fail:d.exception}])};return a("#message_accordion").parent().on("click",".panel-heading.new-message",function(){var b=a(this),c=a("#message_accordion").attr("data-count");c>0&&(a("#message_accordion").attr("data-count",c-1),k()),b.removeClass("new-message");var d=b.attr("data-messageid");l(d)}),a(document).ready(function(){k()}),{}});