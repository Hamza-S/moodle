define(["jquery","core/ajax","core/log","core/notification","core/templates","core/config","core/str","block_oua_connections/jquery.blockUI"],function(a,b,c,d,e,f,g,h){var i,j=function(a){g.get_strings([{key:"error"},{key:"loggedout",component:"local_conversations"},{key:"reload"},{key:"cancel"}]).done(function(b){if("undefined"!=typeof a.errorcode)switch(a.errorcode){case"servicenotavailable":d.confirm(b[0],b[1],b[2],b[3],function(){window.location.reload(!0)});break;default:d.exception(a)}}).fail(function(b){d.exception(a+" "+b)})},k=function(b,c){g.get_string("requested","block_oua_connections").done(function(c){a('button.btn-connect[data-userid="'+b+'"]').text(c).addClass("requested").prop("disabled",!0)}).fail(d.exception),a("#notification_count").change()},l=function(c){var e=b.call([{methodname:"block_oua_connections_request_connection",args:{userid:c}}]);a.when.apply(a,e).done(function(b){k(c,b),a.isFunction(i.unblock)&&i.unblock()}).fail(d.exception)};return a("#suggestedconnections").on("click","div.user-info button.btn-connect",function(){var b=a(this).data("userid");i=a(this).parents(".user-info"),i.block({message:"<span class='glyphicon glyphicon-refresh glyphicon-refresh-animate spinning'></span>"}),l(b)}),a("#myconnections div.nomyconnections").on("click",'a[href="#suggestedconnections"]',function(b){b.preventDefault(),a('a[href="'+a(this).attr("href")+'"]').tab("show")}),{ajax_accept_request_connection:function(a,c,d){b.call([{methodname:"block_oua_connections_accept_request_connection",args:{messageid:a,userid:c},done:function(a){d()},fail:j}])},ajax_ignore_request_connection:function(a,c,d){b.call([{methodname:"block_oua_connections_ignore_request_connection",args:{messageid:a,userid:c},done:function(a){d()},fail:j}])}}});